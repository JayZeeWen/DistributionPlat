@using Distribution.Model;
@model Distribution.Web.Models.OrderModel
@{
    ViewBag.Title = "Home Page";
    Layout = "~/Views/Shared/_LayoutForward.cshtml";
}
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <link type="text/css" rel="stylesheet" href="~/Content/copy/style.css" media="all">
    <link type="text/css" rel="stylesheet" href="~/Content/copy/z.css" media="all">
</head>
<body class="bBg">
    @*<div class="bMain">*@
    ﻿

    <div class="bRight" style="height:800px;">
        <div class="cwNav">
            <a href="Index" >产品商城</a>
            <a  style="background: #fe6c00; color:#FFF;">订单记录</a>
        </div>
        <!--右侧开始-->
        <div class="grDiv1">
            <div class="grDiv1_1"><label>积分明细</label></div>
            <div class="grDiv1_2">

                <table class="cwTab">
                    <tbody>
                        <tr>
                            <th style="width:6%"></th>
                            <th>订单号</th>
                            <th>快递单号</th>
                            <th>当前状态</th>
                            <th>创建时间</th>
                        </tr>
                        @{int index = 1;}
                        @foreach (Order item in Model.orderList.DataList)
                        {
                            <tr>
                                <td style="width:6%">@index</td>
                                <td>@item.c_order_num</td>
                                <td>@item.c_express_num</td>
                                @if (item.c_state == 0)
                                {
                                    <td><a href="" onclick="submitOrder('@item.F_Id')">未下单</a></td>
                                }
                                else if (item.c_state == 1)
                                {
                                    <td>未发货</td>
                                }
                                else
                                {
                                    <td>已受理</td>
                                }
                                <td>@Convert.ToDateTime(item.F_CreatorTime).ToString("yyyy-MM-dd")</td>
                                @{index += 1;}
                            </tr>
                        }
                    </tbody>
                </table>
                <div style="padding-left:20%;padding-top:20px">
                    @Html.Raw(Model.orderList.PagerHtml(size: 5)) 共 @Model.orderList.Total 条
                </div>
            </div>
        </div>


        <script type="text/javascript">
            function submitOrder(orderId) {
                var r = confirm("确认下单吗？");
                if (r) {
                    $.ajax({
                        url: '@Url.Action("PostOrder", "Product")',
                        data: {
                            OrderId: orderId
                        },
                        type: "post",
                        dataType: "json",
                        success: function (data) {
                            if (data.state == "success") {
                                alert("下单成功，请等待发货");
                                var indexUrl = '@Url.Action("OrderRecord", "Product")';
                                window.location.href = indexUrl;
                                return true;
                            } else {
                                alert("提交失败 ： " + data.message)
                            }
                        }
                    });
                }
            }

        </script>
        <!--右侧结束-->
    </div>
    <div class="clearB"></div>
    @*</div>*@
    <style>
        .cwNav{ width:100%; height:36px; margin-bottom:15px;}
        .cwNav a{ font-size:16px; height:36px; line-height:36px; padding:0 15px; display:block; float:left; background:#f2f2f2; color:#292929; border:1px solid #e1e1e1; border-radius:5px; margin-right:10px;}
    </style>
</body>
</html>